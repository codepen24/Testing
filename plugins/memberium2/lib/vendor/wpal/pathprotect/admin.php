<?php
/**
 * Copyright (c) 2020 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 if ( !defined( 'ABSPATH' ) ) { die(); } final class wpalm4is_z7z2e_3r { function wpalm4is_xwghej8asd4() { if ( ! defined( 'DOING_CRON' ) && current_user_can( 'manage_options' ) ) { add_action('admin_menu', array( $this, 'wpalm4is_al4w9o' ) ); } } function wpalm4is_al4w9o() { if ( current_user_can( 'manage_options' ) ) { add_options_page( __('WPaL Path Protect'), __('WPaL Path Protect'), 'manage_options', 'pathprotect', array( $this, 'wpalm4is_hh84z_7' ) ); } } function wpalm4is_hh84z_7() { if ( ! current_user_can( 'manage_options' ) ) { wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); } $vwpalm4is_ne17fdv8uw4 = $this->wpalm4is_ervnpt65c9_k(); $vwpalm4is_sxkc2voun = $_POST; $vwpalm4is_g1rau5s = $_SERVER; if ( $vwpalm4is_g1rau5s['REQUEST_METHOD'] == 'POST' ) { if (! empty($vwpalm4is_sxkc2voun['update_rules']) ) { $vwpalm4is_ne17fdv8uw4['rules'] = array(); if ( isset($_POST['rules']) && is_array( $_POST['rules'] ) ) { foreach( $_POST['rules'] as $vwpalm4is_mv7r9ml ) { $vwpalm4is_mv7r9ml['urls'] = trim( $vwpalm4is_mv7r9ml['urls'] ); if ( $vwpalm4is_mv7r9ml['anonymous_only'] ) { $vwpalm4is_mv7r9ml['logged_in'] = 0; } if ( $vwpalm4is_mv7r9ml['logged_in'] ) { $vwpalm4is_mv7r9ml['anonymous_only'] = 0; }  if ( $vwpalm4is_mv7r9ml['prohibited_action'] == 'redirect' && empty( $vwpalm4is_mv7r9ml['redirect_url'] ) ) { $vwpalm4is_mv7r9ml['redirect_url'] = get_site_url(); } if ( ! empty( $vwpalm4is_mv7r9ml['urls'] ) && $vwpalm4is_mv7r9ml['delete'] == 0 ) { $vwpalm4is_ne17fdv8uw4['rules'][] = $vwpalm4is_mv7r9ml; } } } } if ( ! empty( $_POST['add_rules'] ) ) { $vwpalm4is_ne17fdv8uw4['rules'][] = array(); } $this->wpalm4is_ky82cl5j0k4e($vwpalm4is_ne17fdv8uw4); } $vwpalm4is_jkd5plhf0y = array(); $vwpalm4is_jkd5plhf0y['hide'] = 'Hide Completely'; $vwpalm4is_jkd5plhf0y['redirect'] = 'Redirect'; echo '<style>'; echo 'label { width:200px; display:inline-block; }'; echo '#htmlmessage { width:500px !important; }'; echo '</style>'; echo '<div class="wrap">'; echo '<h1>Path Protect for Membership Sites</h1>'; echo '<form method="POST" action="">'; echo '<ul>'; echo '</ul>'; echo '<h3>Current Rules</h3>'; echo '<div style="width:800px;">'; echo '<hr />'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr style="font-weight:bold;">'; echo '<th>Requirements</th>'; echo '<th>URLs</th>'; echo '<th>Prohibited Action</th>'; echo '<th>Delete?</th>'; echo '</tr>'; if ( is_array($vwpalm4is_ne17fdv8uw4['rules']) && count( $vwpalm4is_ne17fdv8uw4['rules'] ) ) { foreach ( $vwpalm4is_ne17fdv8uw4['rules'] as $vwpalm4is_x3e6m_hobj => $vwpalm4is_mv7r9ml ) { $vwpalm4is_mv7r9ml['logged_in'] = isset( $vwpalm4is_mv7r9ml['logged_in'] ) ? $vwpalm4is_mv7r9ml['logged_in'] : 0; $vwpalm4is_mv7r9ml['anonymous_only'] = isset( $vwpalm4is_mv7r9ml['anonymous_only'] ) ? $vwpalm4is_mv7r9ml['anonymous_only'] : 0; $vwpalm4is_mv7r9ml['urls'] = isset( $vwpalm4is_mv7r9ml['urls'] ) ? $vwpalm4is_mv7r9ml['urls'] : ''; $vwpalm4is_mv7r9ml['redirect_url'] = isset( $vwpalm4is_mv7r9ml['redirect_url'] ) ? $vwpalm4is_mv7r9ml['redirect_url'] : ''; echo '<tr>'; echo '<td>'; echo '<input type="hidden" name="rules[', $vwpalm4is_x3e6m_hobj, '][logged_in]" value="0">'; echo '<input type="checkbox" value="1" name="rules[', $vwpalm4is_x3e6m_hobj, '][logged_in]"', $vwpalm4is_mv7r9ml['logged_in'] == 1 ? ' checked="checked" ' : '', ' /> Logged In<br>'; echo '<input type="hidden" name="rules[', $vwpalm4is_x3e6m_hobj, '][anonymous_only]" value="0">'; echo '<input type="checkbox" value="1" name="rules[', $vwpalm4is_x3e6m_hobj, '][anonymous_only]"', $vwpalm4is_mv7r9ml['anonymous_only'] == 1 ? ' checked="checked" ' : '', ' /> Anonymous Only<br>'; echo '</td>'; $vwpalm4is_jdghip = count( explode( "\n", $vwpalm4is_mv7r9ml['urls'] ) ); echo '<td>'; echo '<textarea cols="80" rows="', $vwpalm4is_jdghip + 1, '" name="rules[', $vwpalm4is_x3e6m_hobj, '][urls]">', $vwpalm4is_mv7r9ml['urls'], '</textarea>'; echo '</td>'; echo '<td>'; echo '<select name="rules[', $vwpalm4is_x3e6m_hobj, '][prohibited_action]">'; foreach ( $vwpalm4is_jkd5plhf0y as $vwpalm4is_kh9vqi_6znd => $vwpalm4is_tbz0wc5kj37 ) { $vwpalm4is_gn5r9l1ip4km = $vwpalm4is_mv7r9ml['prohibited_action'] == $vwpalm4is_kh9vqi_6znd ? ' selected="selected" ' : ''; echo '<option value="' . $vwpalm4is_kh9vqi_6znd . '" ' . $vwpalm4is_gn5r9l1ip4km . '>' . $vwpalm4is_tbz0wc5kj37 . '</option>'; } echo '</select><br />'; echo 'Redirection URL<br>'; echo '<input type="text" name="rules[', $vwpalm4is_x3e6m_hobj, '][redirect_url]" value="', $vwpalm4is_mv7r9ml['redirect_url'],'">'; echo '</td>'; echo '<td>'; echo '<input type="hidden" name="rules[', $vwpalm4is_x3e6m_hobj, '][delete]" value="0">'; echo '<input type="checkbox" name="rules[', $vwpalm4is_x3e6m_hobj, '][delete]" value="1">'; echo '</td>'; echo '</tr>'; } } else { echo '<tr><td colspan="99">You have no rules created</td></tr>'; } echo '</table>'; echo '&nbsp;<br>'; echo '<input type="submit" name="update_rules" value="Save Changes" class="button-primary" />'; echo '</form>'; echo '<form method="post">'; echo '&nbsp;<br>'; echo '<input type="submit" name="add_rules" value="Add Ruleset" class="button-primary" />'; echo '</form>'; echo '</div>'; echo '</div>'; } function __construct() { $this->settings = get_option('MemberiumPathProtect'); unset($this->settings['active']); add_action('init', array( $this, 'wpalm4is_xwghej8asd4' ), 9 ); } private function wpalm4is_ervnpt65c9_k() { $vwpalm4is_x3e6m_hobj = 'WPAL/pathprotect/settings'; $vwpalm4is_t9yr_q8xv7cz = 'MemberiumPathProtect'; $vwpalm4is_ne17fdv8uw4 = get_option($vwpalm4is_x3e6m_hobj, false); if ($vwpalm4is_ne17fdv8uw4 === false) { $vwpalm4is_ne17fdv8uw4 = get_option($vwpalm4is_t9yr_q8xv7cz, ''); if (is_array($vwpalm4is_ne17fdv8uw4) ) { update_option($vwpalm4is_x3e6m_hobj, $vwpalm4is_ne17fdv8uw4); } } return $vwpalm4is_ne17fdv8uw4; } private function wpalm4is_ky82cl5j0k4e($vwpalm4is_ne17fdv8uw4) { $vwpalm4is_x3e6m_hobj = 'WPAL/pathprotect/settings'; $vwpalm4is_t9yr_q8xv7cz = 'MemberiumPathProtect'; update_option($vwpalm4is_x3e6m_hobj, $vwpalm4is_ne17fdv8uw4); delete_option($vwpalm4is_t9yr_q8xv7cz); } private $settings; }

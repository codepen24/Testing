<?php
 if (! defined('ABSPATH') ) { die(); } final class wpalm4is_h6henu { function wpalm4is_qka65vyfn() { add_action('rest_api_init', array($this, 'wpalm4is_yo_nlv') ); add_action('rest_api_init', array($this, 'wpalm4is_xmvue_g') );  add_action('rest_api_init', array($this, 'wpalm4is_gud3fjksxy') ); add_filter('wp_authenticate_user', array($this, 'wpalm4is_g2_rcvpqhdi'), 10, 2);  } function wpalm4is_yo_nlv() {  register_rest_field('post', 'featured_image_urls', array( 'get_callback' => array($this, 'wpalm4is_pztr7eduyl'), 'update_callback' => null, 'schema' => null, ) );  $vwpalm4is_wfiy8_u5j6r = appp_get_setting('media_post_types'); if (!empty($vwpalm4is_wfiy8_u5j6r) ) { foreach ($vwpalm4is_wfiy8_u5j6r as $vwpalm4is_o_6p9tyav) { register_rest_field($vwpalm4is_o_6p9tyav, 'appp_media', array( 'get_callback' => array($this, 'wpalm4is_aew48i9s'), 'update_callback' => null, 'schema' => null, ) ); } } }  function wpalm4is_s5moc18pw6hu($vwpalm4is_refzyu) { $vwpalm4is_eaotlygk9684['user_login'] = ($_POST['username'] ? $_POST['username'] : $_SERVER['PHP_AUTH_USER']); $vwpalm4is_eaotlygk9684['user_password'] = ($_POST['password'] ? $_POST['password'] : $_SERVER['PHP_AUTH_PW']); $vwpalm4is_eaotlygk9684['remember'] = true; if (empty($vwpalm4is_eaotlygk9684['user_login']) || empty($vwpalm4is_eaotlygk9684['user_password']) ) { $vwpalm4is_fsg2vw = array( 'success' => false, 'data' => array( 'message' => apply_filters('appp_login_error', __('Login missing required fields.', 'apppresser'), ''), 'success' => false ) ); return rest_ensure_response($vwpalm4is_fsg2vw); } do_action('appp_before_signon', $vwpalm4is_eaotlygk9684); $vwpalm4is_n7iul51nce_g = wp_signon($vwpalm4is_eaotlygk9684, false); do_action('appp_login_header'); if (is_wp_error($vwpalm4is_n7iul51nce_g) ) { $vwpalm4is_fsg2vw = array( 'success' => false, 'data' => array( 'message' => apply_filters('appp_login_error', __('The login you have entered is not valid.', 'apppresser'), $vwpalm4is_eaotlygk9684['user_login']), 'success' => false ) ); return rest_ensure_response($vwpalm4is_fsg2vw); } else {  $vwpalm4is_mexhw491u = $this->wpalm4is_q7ygbnv($vwpalm4is_n7iul51nce_g->ID); $vwpalm4is_fsg2vw = array( 'message' => apply_filters('appp_login_success', sprintf(__('Welcome back %s!', 'apppresser'), $vwpalm4is_n7iul51nce_g->display_name), $vwpalm4is_n7iul51nce_g->ID), 'username' => $vwpalm4is_eaotlygk9684['user_login'], 'avatar' => get_avatar_url($vwpalm4is_n7iul51nce_g->ID), 'cookie_auth' => $vwpalm4is_mexhw491u, 'login_redirect' => AppPresser_Ajax_Extras::get_login_redirect(),  'success' => true, 'user_id' => $vwpalm4is_n7iul51nce_g->ID ); } $vwpalm4is_fsg2vw = apply_filters('appp_login_data', $vwpalm4is_fsg2vw, $vwpalm4is_n7iul51nce_g->ID); $retval = rest_ensure_response($vwpalm4is_fsg2vw); return $retval; }  function wpalm4is_qt304sehw1y($vwpalm4is_refzyu) { do_action('appp_logout_header'); if (! defined('DOING_AJAX') ) { define('DOING_AJAX', true); } wp_logout(); $vwpalm4is_zi96wnzyh0o = array( 'message' => __('Logout success.', 'apppresser'), 'success' => true ); $vwpalm4is_d4ns2m5 = $this->wpalm4is_dgzjos5cde9(); if ($vwpalm4is_d4ns2m5) { $vwpalm4is_zi96wnzyh0o['logout_redirect'] = $vwpalm4is_d4ns2m5; } $vwpalm4is_uztmg6op = rest_ensure_response($vwpalm4is_zi96wnzyh0o); return $vwpalm4is_uztmg6op; }  function wpalm4is_xmvue_g() {  if (appp_get_setting('ap3_enable_cors', false) ) { add_filter('appp_allow_api_origin', function() { return '*'; }); $this->wpalm4is__0apb4s8hwdj(); } else { add_filter('appp_allow_api_origin', function() { return false; }); } }  function wpalm4is__0apb4s8hwdj() { $vwpalm4is_hfljwa = apply_filters('appp_allow_api_origin', '*'); $vwpalm4is_jp4kjn = apply_filters('appp_allow_api_methods', 'GET,PUT,POST,DELETE,PATCH,OPTIONS'); if ($appp_allow_origin) { header("Access-Control-Allow-Origin: {$vwpalm4is_hfljwa}"); header("Access-Control-Allow-Methods: {$vwpalm4is_jp4kjn}"); } }  function wpalm4is_g2_rcvpqhdi($vwpalm4is_n_bsw6d3x, $vwpalm4is_t15xztu_wb2) { if (get_user_meta($vwpalm4is_n_bsw6d3x->ID, 'app_unverified', true) ) { return new WP_Error('app_unverified_login', __('You have not verified your account by email, please contact support.', 'apppresser'), array( 'status' => 404, ) ); } return $vwpalm4is_n_bsw6d3x; }  function wpalm4is_q7ygbnv($vwpalm4is_tcon6xrp) { if (function_exists('openssl_encrypt') ) { $vwpalm4is_x3e6m_hobj = substr(AUTH_KEY, 2, 5); $vwpalm4is_yz5a78 = substr(AUTH_KEY, 0, 16); $vwpalm4is_y7zxo2uh = "AES-128-CBC"; $vwpalm4is_ewpf5142 = openssl_encrypt($vwpalm4is_tcon6xrp, $vwpalm4is_y7zxo2uh, $vwpalm4is_x3e6m_hobj, null, $vwpalm4is_yz5a78); } else {  $vwpalm4is_ewpf5142 = $vwpalm4is_tcon6xrp; } update_user_meta($vwpalm4is_tcon6xrp, 'app_cookie_auth', $vwpalm4is_ewpf5142); return $vwpalm4is_ewpf5142; }  function wpalm4is_dgzjos5cde9() { if (has_filter('appp_logout_redirect') ) { $vwpalm4is_kp5xz8 = apply_filters('appp_logout_redirect', ''); return AppPresser_Ajax_Extras::add_redirect_title($vwpalm4is_kp5xz8); } else { return ''; } } function wpalm4is_aew48i9s($vwpalm4is_sxkc2voun) { $vwpalm4is_kh9vqi_6znd = get_post_meta($vwpalm4is_sxkc2voun['id'], 'appp_media_url', true); $vwpalm4is_n0wrho_2u = array(); if (empty($vwpalm4is_kh9vqi_6znd)) { return; } $vwpalm4is_n0wrho_2u['media_url'] = $vwpalm4is_kh9vqi_6znd; $vwpalm4is_l9s_zn = get_post_meta($vwpalm4is_sxkc2voun['id'], 'appp_media_image', true); if (! empty($vwpalm4is_l9s_zn) ) { $vwpalm4is_n0wrho_2u['media_image'] = $vwpalm4is_l9s_zn; } return $vwpalm4is_n0wrho_2u; }  function wpalm4is_n104o3grb($vwpalm4is_refzyu) { $vwpalm4is_dzqjf460 = $vwpalm4is_refzyu['email']; $vwpalm4is_n_bsw6d3x = get_user_by('email', $vwpalm4is_dzqjf460); if ($vwpalm4is_n_bsw6d3x) { $vwpalm4is_yq9zlicjw = current_time('mysql'); $vwpalm4is_cvr78fis = $this->wpalm4is_ugr9fi46v();  update_user_meta($vwpalm4is_n_bsw6d3x->ID, 'app_hash', $vwpalm4is_cvr78fis); $vwpalm4is_kj2hs9t = __('App Password Reset', 'apppresser'); $vwpalm4is_kj2hs9t = apply_filters('appp_pw_reset_email_subject', $vwpalm4is_kj2hs9t); $vwpalm4is_pl2e5v7_ = __('Enter the code into the app to reset your password. Code: ', 'apppresser') . $vwpalm4is_cvr78fis; $vwpalm4is_pl2e5v7_ = apply_filters('appp_pw_reset_email', $vwpalm4is_pl2e5v7_, $vwpalm4is_cvr78fis); $mail = wp_mail($vwpalm4is_n_bsw6d3x->user_email, $vwpalm4is_kj2hs9t, $vwpalm4is_pl2e5v7_); $return = array( 'success' => true, 'got_code' => true, 'message' => __('Please check your email for your verification code.', 'apppresser') ); } else { $return = array( 'success' => false, 'message' => __('The email you have entered is not valid.', 'apppresser') ); } return $return; } function wpalm4is_ugr9fi46v() { $vwpalm4is_xyf9tvd3rg = str_split('1234567890'); $vwpalm4is_ktc_r0f7z4 = str_split('abcdefghijklmnopqrstuvwxyz'); shuffle($vwpalm4is_xyf9tvd3rg); shuffle($vwpalm4is_ktc_r0f7z4); $vwpalm4is_d5kqsi90y = $vwpalm4is_xyf9tvd3rg[1] . $vwpalm4is_ktc_r0f7z4[1] . $vwpalm4is_ktc_r0f7z4[2] . $vwpalm4is_xyf9tvd3rg[3]; return $vwpalm4is_d5kqsi90y; } function wpalm4is_pztr7eduyl($vwpalm4is_sxkc2voun) { $vwpalm4is_vupkjqdso3 = get_post_thumbnail_id($vwpalm4is_sxkc2voun['id']); $vwpalm4is_ypj5480rbf1 = wp_get_attachment_metadata($vwpalm4is_vupkjqdso3); $vwpalm4is_h1i6exl7q0s_ = new stdClass(); if (! empty($vwpalm4is_ypj5480rbf1['sizes']) ) { foreach ($vwpalm4is_ypj5480rbf1['sizes'] as $key => $size) {  $image_src = wp_get_attachment_image_src($vwpalm4is_vupkjqdso3, $key); if (! $image_src) { continue; } $vwpalm4is_h1i6exl7q0s_->$key = $image_src[0]; } } return $vwpalm4is_h1i6exl7q0s_; }  function wpalm4is_gud3fjksxy() {  if (! class_exists('WP_REST_Controller') ) { return; } $vwpalm4is_rbz0m7xc = 'appp/v1'; $vwpalm4is_rlur4zm9vfpx = 'methods'; $vwpalm4is_l8vrlnk = 'callback'; $vwpalm4is_pseuykmop7 = WP_REST_Server::CREATABLE; $vwpalm4is_dwgra_s3 = WP_REST_Server::READABLE; register_rest_route($vwpalm4is_rbz0m7xc, '/login', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_pseuykmop7, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_s5moc18pw6hu') ), ) ); register_rest_route($vwpalm4is_rbz0m7xc, '/logout', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_dwgra_s3, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_qt304sehw1y') ), ) ); register_rest_route($vwpalm4is_rbz0m7xc, '/register', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_pseuykmop7, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_it9boa1g3x') ), ) ); register_rest_route($vwpalm4is_rbz0m7xc, '/verify', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_pseuykmop7, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_dqj4edrwulv') ), ) ); register_rest_route($vwpalm4is_rbz0m7xc, '/verify-resend', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_pseuykmop7, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_gloy3bx64t') ), ) ); register_rest_route($vwpalm4is_rbz0m7xc, '/reset-password', array( array( $vwpalm4is_rlur4zm9vfpx => $vwpalm4is_pseuykmop7, $vwpalm4is_l8vrlnk => array($this, 'wpalm4is_x8lgz6rkm3') ), ) ); }  function wpalm4is_it9boa1g3x($vwpalm4is_refzyu) { if (empty($vwpalm4is_refzyu['username']) || empty($vwpalm4is_refzyu['email']) ) { return new WP_Error('rest_invalid_registration', __('Missing required fields.', 'apppresser'), array( 'status' => 404, ) ); } if (email_exists($vwpalm4is_refzyu['email']) || username_exists($vwpalm4is_refzyu['username']) ) { return new WP_Error('rest_invalid_registration', __('Email or username already exists.', 'apppresser'), array( 'status' => 404, ) ); } if (empty($vwpalm4is_refzyu['password']) ) { $vwpalm4is_t15xztu_wb2 = wp_generate_password(8);  } else { $vwpalm4is_t15xztu_wb2 = $vwpalm4is_refzyu['password']; } $vwpalm4is__joasq7mg = array( 'user_login' => $vwpalm4is_refzyu['username'], 'user_pass' => $vwpalm4is_t15xztu_wb2, 'user_email' => $vwpalm4is_refzyu['email'], 'first_name' => $vwpalm4is_refzyu['first_name'], 'last_name' => $vwpalm4is_refzyu['last_name'] ); $vwpalm4is_tcon6xrp = wp_insert_user($vwpalm4is__joasq7mg); if (is_wp_error($vwpalm4is_tcon6xrp) ) { return new WP_Error('rest_invalid_registration', __('Something went wrong with registration.', 'apppresser'), array( 'status' => 404, ) ); } update_user_meta($vwpalm4is_tcon6xrp, 'app_unverified', true); $vwpalm4is_y3qfd2ir9l = $this->wpalm4is_gloy3bx64t($vwpalm4is_refzyu);  if (! $vwpalm4is_y3qfd2ir9l) { return new WP_Error('rest_invalid_registration', __('We could not send your verification code by email, please contact support.', 'apppresser'), array( 'status' => 404, ) ); } do_action('appp_register_unverified', $vwpalm4is_tcon6xrp); $vwpalm4is_d8zcdwxjh1 = __("Your verification code has been sent, please check your email.", "apppresser"); $vwpalm4is_uztmg6op = rest_ensure_response($vwpalm4is_d8zcdwxjh1); return $vwpalm4is_uztmg6op; }  function wpalm4is_x8lgz6rkm3($vwpalm4is_refzyu) { $vwpalm4is_lj4srzwt5yx1 = array( 'success' => false, 'message' => 'Missing required fields.' ); if (isset($vwpalm4is_refzyu['code']) && isset($vwpalm4is_refzyu['password']) ) { $vwpalm4is_lj4srzwt5yx1 = $this->wpalm4is_s8gmsvleqdw($vwpalm4is_refzyu); } elseif (isset($vwpalm4is_refzyu['email']) ) { $vwpalm4is_lj4srzwt5yx1 = $this->wpalm4is_n104o3grb($vwpalm4is_refzyu); } return $vwpalm4is_lj4srzwt5yx1; }  function wpalm4is_gloy3bx64t($vwpalm4is_refzyu) { if (empty($vwpalm4is_refzyu['email']) || empty($vwpalm4is_refzyu['username']) ) { return new WP_Error('rest_invalid_verification', __('Missing required field.', 'apppresser'), array( 'status' => 404, ) ); } if (! email_exists($vwpalm4is_refzyu['email']) || ! username_exists($vwpalm4is_refzyu['username']) ) { return new WP_Error('rest_invalid_verification', __('Invalid username or email.', 'apppresser'), array( 'status' => 404, ) ); } $vwpalm4is_xy398am1 = hash('md5', $vwpalm4is_refzyu['username'] . $vwpalm4is_refzyu['email']);  $vwpalm4is_xy398am1 = substr($vwpalm4is_xy398am1, 1, 4);  $vwpalm4is_kj2hs9t = __('Your Verification Code', 'apppresser'); $vwpalm4is_kj2hs9t = apply_filters('appp_verification_email_subject', $vwpalm4is_kj2hs9t); $vwpalm4is__lstjamupz = sprintf(__("Hi, thanks for registering! Here is your verification code: %s \n\nPlease enter this code in the app. \n\nThanks!", "apppresser"), $vwpalm4is_xy398am1); $vwpalm4is__lstjamupz = apply_filters('appp_verification_email', $vwpalm4is__lstjamupz, $vwpalm4is_xy398am1); $vwpalm4is_y3qfd2ir9l = wp_mail($vwpalm4is_refzyu["email"], $vwpalm4is_kj2hs9t, $vwpalm4is__lstjamupz); return $vwpalm4is_y3qfd2ir9l; }  function wpalm4is_s8gmsvleqdw($vwpalm4is_refzyu) { global $wpdb; $vwpalm4is_d5kqsi90y = $vwpalm4is_refzyu['code']; $vwpalm4is_t15xztu_wb2 = $vwpalm4is_refzyu['password']; $vwpalm4is_g87myl0d = array( 'meta_key' => 'app_hash', 'meta_value' => $vwpalm4is_d5kqsi90y ); $vwpalm4is_n_bsw6d3x = get_users($vwpalm4is_g87myl0d); if ($vwpalm4is_n_bsw6d3x) { $vwpalm4is_g87myl0d = array( 'ID' => $vwpalm4is_n_bsw6d3x[0]->data->ID, 'user_pass' => $vwpalm4is_t15xztu_wb2 ); wp_update_user($vwpalm4is_g87myl0d) ; delete_user_meta($vwpalm4is_n_bsw6d3x[0]->data->ID, 'app_hash');  $vwpalm4is_lj4srzwt5yx1 = array( 'message' => __('Your password has been changed, please login.', 'apppresser'), 'pw_changed' => true, 'success' => true ); } else { $vwpalm4is_lj4srzwt5yx1 = array( 'success' => false, 'message' => __('The code you have entered is not valid.', 'apppresser') ); } return $vwpalm4is_lj4srzwt5yx1; }  function wpalm4is_dqj4edrwulv($vwpalm4is_refzyu) { if (empty($vwpalm4is_refzyu['email']) || empty($vwpalm4is_refzyu['verification']) ) { return new WP_Error('rest_invalid_verification', __('Missing required field.', 'apppresser'), array( 'status' => 404, ) ); } $vwpalm4is_xy398am1 = hash('md5', $vwpalm4is_refzyu['username'] . $vwpalm4is_refzyu['email']); $vwpalm4is_xy398am1 = substr($vwpalm4is_xy398am1, 1, 4); if ($vwpalm4is_refzyu['verification'] != strval($vwpalm4is_xy398am1) ) {  return new WP_Error('rest_invalid_verification', __('The verification code does not match.', 'apppresser'), array( 'status' => 404, ) ); } $vwpalm4is_n_bsw6d3x = get_user_by('email', $vwpalm4is_refzyu['email']); delete_user_meta($vwpalm4is_n_bsw6d3x->ID, 'app_unverified');  $info = array(); $info['user_login'] = $vwpalm4is_refzyu['username']; $info['user_password'] = $vwpalm4is_refzyu['password']; $info['remember'] = true; $user_signon = wp_signon($info, false); if (is_wp_error($user_signon) || !$vwpalm4is_n_bsw6d3x) { return new WP_Error('rest_invalid_verification', __('Verification succeeded, please login.', 'apppresser'), array( 'status' => 200, ) ); } $vwpalm4is_pl2e5v7_ = array( 'message' => apply_filters('appp_login_success', sprintf(__('Welcome back %s!', 'apppresser'), $user_signon->display_name), $user_signon->ID), 'username' => $info['user_login'], 'avatar' => get_avatar_url($user_signon->ID),  'success' => true, 'user_id' => $user_signon->ID );  $vwpalm4is_pl2e5v7_ = apply_filters('appp_login_data', $vwpalm4is_pl2e5v7_, $user_signon->ID); do_action('appp_register_verified', $user_signon->ID); $vwpalm4is_uztmg6op = rest_ensure_response($vwpalm4is_pl2e5v7_); return $vwpalm4is_uztmg6op; }  function __construct() { $this->wpalm4is_qka65vyfn(); } }

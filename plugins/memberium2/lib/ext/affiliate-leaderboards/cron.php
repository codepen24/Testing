<?php
 if ( !defined( 'ABSPATH' ) ) { die(); } return new wpalm4is_vkx2ir45; class wpalm4is_vkx2ir45 { private $appname; private $isdk; private $today; private $inf_today; function __construct() { global $i2sdk; $this->today = date( 'Y-m-d' ); $this->in_today_start = date( 'Ymd\T00:00:00' ); $this->in_today_end = date( 'Ymd\T23:59:59' ); $this->isdk = $i2sdk->isdk; $this->appname = wpalm4is_xb7t0i6pzn::wpalm4is_mz346l5qyv('appname'); $this->affcore = $GLOBALS['memberium_modules']['affiliate-leaderboards']['core']; add_action('memberium_maintenance12', array( $this, 'wpalm4is_pk1p5bdmn' ) ); } function wpalm4is_wb37tey() { global $wpdb; $vwpalm4is_dd4j20qwmn_ = $this->appname; $vwpalm4is_cevdqnb5lzm = 'SELECT `id` FROM `' . MEMBERIUM_DB_AFFILIATES . '` WHERE ( `appname` = %s AND `fieldname` = "AffName" ) AND ( `value` LIKE "!%%" ) OR ( `value` LIKE "(INTERNAL)%%" );'; $vwpalm4is_cevdqnb5lzm = $wpdb->prepare( $vwpalm4is_cevdqnb5lzm, $vwpalm4is_dd4j20qwmn_ ); $vwpalm4is_kasrikuc = $wpdb->get_col( $vwpalm4is_cevdqnb5lzm ); if ( is_array( $vwpalm4is_kasrikuc ) ) { return $vwpalm4is_kasrikuc; } return array(); } function wpalm4is_pk1p5bdmn() { $vwpalm4is_h5hmp47voj = $this->affcore->wpalm4is_k9cd7zw6(); foreach( $vwpalm4is_h5hmp47voj as $vwpalm4is_x3e6m_hobj => $vwpalm4is_ylzogxqvs7d ) { $vwpalm4is_v4s53ml0z = array(); if ( empty( $vwpalm4is_ylzogxqvs7d['cache'] ) || ( $vwpalm4is_ylzogxqvs7d['start_date'] <= $this->today && $vwpalm4is_ylzogxqvs7d['end_date'] >= $this->today ) ) { $vwpalm4is_h5hmp47voj[$vwpalm4is_x3e6m_hobj] = $this->wpalm4is_v3n_1kapwi( $vwpalm4is_ylzogxqvs7d ) ; } } $this->affcore->wpalm4is_jrb85u36ky( $vwpalm4is_h5hmp47voj ); } function wpalm4is_v3n_1kapwi( $vwpalm4is_ylzogxqvs7d ) { $vwpalm4is_v4s53ml0z = array(); if ( $vwpalm4is_ylzogxqvs7d['type'] == 'leads' ) { $vwpalm4is_v4s53ml0z = $this->wpalm4is_vile2xy( $vwpalm4is_ylzogxqvs7d ); } elseif ( in_array( $vwpalm4is_ylzogxqvs7d['type'], array( 'dollars', 'invoices' ) ) ) { $vwpalm4is_v4s53ml0z = $this->wpalm4is_sb1na4x3_2ce( $vwpalm4is_ylzogxqvs7d ); } $vwpalm4is_ylzogxqvs7d['cache'] = $vwpalm4is_v4s53ml0z; $vwpalm4is_ylzogxqvs7d['last_updated'] = time(); return $vwpalm4is_ylzogxqvs7d; } function wpalm4is_vile2xy( $vwpalm4is_ylzogxqvs7d ) { $vwpalm4is_oxb71pgsnt = $this->wpalm4is_wb37tey();  $vwpalm4is_yuknbx = date( 'Ymd\T23:59:59', strtotime( $vwpalm4is_ylzogxqvs7d['end_date'] ) ); $vwpalm4is_v4s53ml0z = array(); $vwpalm4is__mnral5zjy = 'Referral'; $vwpalm4is_e8ns965uk = 1000; $vwpalm4is_cshmxpk = 0; $vwpalm4is_dd4j20qwmn_ = $this->appname; $vwpalm4is_mq3gv6sdxeu = array( 'AffiliateId', 'ContactId', 'DateSet', ); $vwpalm4is_fqzgw57 = array( 'DateSet' => '~>=~ ' . $vwpalm4is_ylzogxqvs7d['start_date'], ); do { $vwpalm4is_kmqnwo6cu5 = $this->isdk->dsQueryOrderBy( $vwpalm4is__mnral5zjy, $vwpalm4is_e8ns965uk, $vwpalm4is_cshmxpk, $vwpalm4is_fqzgw57, $vwpalm4is_mq3gv6sdxeu, 'DateSet', true ); foreach( $vwpalm4is_kmqnwo6cu5 as $vwpalm4is_hs69ar ) { if ( $vwpalm4is_hs69ar['DateSet'] <= $vwpalm4is_yuknbx ) { if ( ! in_array( $vwpalm4is_hs69ar['AffiliateId'], $vwpalm4is_oxb71pgsnt ) ) { $vwpalm4is_v4s53ml0z[$vwpalm4is_hs69ar['AffiliateId']]++; } } } $vwpalm4is_cshmxpk++; $vwpalm4is_huym27 = $vwpalm4is_huym27 + count( $vwpalm4is_kmqnwo6cu5 ); } while ( count( $vwpalm4is_kmqnwo6cu5 ) == $vwpalm4is_e8ns965uk ); arsort( $vwpalm4is_v4s53ml0z ); unset( $vwpalm4is_v4s53ml0z[0] ); $vwpalm4is_v4s53ml0z = array_slice( $vwpalm4is_v4s53ml0z, 0, $vwpalm4is_ylzogxqvs7d['slots'], true ); return $vwpalm4is_v4s53ml0z; } function wpalm4is_sb1na4x3_2ce( $vwpalm4is_ylzogxqvs7d ) { $vwpalm4is_oxb71pgsnt = $this->wpalm4is_wb37tey();  $vwpalm4is_yuknbx = date( 'Ymd\T23:59:59', strtotime( $vwpalm4is_ylzogxqvs7d['end_date'] ) ); $vwpalm4is_v4s53ml0z = array(); $vwpalm4is_rs3pwinam7 = array(); $vwpalm4is__mnral5zjy = 'Invoice'; $vwpalm4is_e8ns965uk = 1000; $vwpalm4is_cshmxpk = 0; $vwpalm4is_dd4j20qwmn_ = $this->appname; $vwpalm4is_ybedz3xs6w = array_filter( explode( ',', $vwpalm4is_ylzogxqvs7d['products'] ) ); $vwpalm4is_mq3gv6sdxeu = array( 'AffiliateId', 'LeadAffiliateId', 'DateCreated', 'InvoiceTotal', 'ProductSold', ); $vwpalm4is_fqzgw57 = array( 'DateCreated' => '~>=~ ' . date( 'Ymd\This', strtotime( $vwpalm4is_ylzogxqvs7d['start_date'] ) ), 'PayStatus' => 1, 'RefundStatus' => 0, ); do { $vwpalm4is_kmqnwo6cu5 = $this->isdk->dsQueryOrderBy( $vwpalm4is__mnral5zjy, $vwpalm4is_e8ns965uk, $vwpalm4is_cshmxpk, $vwpalm4is_fqzgw57, $vwpalm4is_mq3gv6sdxeu, 'DateCreated', true ); foreach( $vwpalm4is_kmqnwo6cu5 as $vwpalm4is_hs69ar ) { $vwpalm4is_fawi64knts = (int) $vwpalm4is_hs69ar['AffiliateId']; $vwpalm4is_gyefdl_kq13 = (int) $vwpalm4is_hs69ar['LeadAffiliateId']; $vwpalm4is_yazckx_evtw = array_filter( explode( ',', $vwpalm4is_hs69ar['ProductSold'] ) ); $vwpalm4is_cnivz3qbu = (bool) ( $vwpalm4is_fawi64knts > 0 || $vwpalm4is_gyefdl_kq13 > 0 ); $vwpalm4is_cnivz3qbu = $vwpalm4is_cnivz3qbu && ( $vwpalm4is_hs69ar['DateCreated'] < $vwpalm4is_yuknbx ); $vwpalm4is_cnivz3qbu = $vwpalm4is_cnivz3qbu && ( ! in_array( $vwpalm4is_fawi64knts, $vwpalm4is_oxb71pgsnt ) ); if ( $vwpalm4is_cnivz3qbu && ! empty( $vwpalm4is_ybedz3xs6w ) ) { $vwpalm4is_iwep4mr6tb9c = array_intersect( $vwpalm4is_ybedz3xs6w, $vwpalm4is_yazckx_evtw ); $vwpalm4is_cnivz3qbu = ! empty( $vwpalm4is_iwep4mr6tb9c ); } if ( $vwpalm4is_cnivz3qbu ) { if ( $vwpalm4is_ylzogxqvs7d['type'] == 'dollars' ) { $vwpalm4is_v4s53ml0z[$vwpalm4is_fawi64knts] += (double) $vwpalm4is_hs69ar['InvoiceTotal']; } elseif ( $vwpalm4is_ylzogxqvs7d['type'] == 'invoices' ) { $vwpalm4is_v4s53ml0z[$vwpalm4is_fawi64knts]++; } } } $vwpalm4is_cshmxpk++; $vwpalm4is_huym27 = $vwpalm4is_huym27 + count( $vwpalm4is_kmqnwo6cu5 ); } while ( count( $vwpalm4is_kmqnwo6cu5 ) == $vwpalm4is_e8ns965uk ); unset( $vwpalm4is_v4s53ml0z[0], $vwpalm4is_rs3pwinam7[0] ); arsort( $vwpalm4is_v4s53ml0z ); $vwpalm4is_v4s53ml0z = array_slice( $vwpalm4is_v4s53ml0z, 0, $vwpalm4is_ylzogxqvs7d['slots'], true ); return $vwpalm4is_v4s53ml0z; } function wpalm4is_ppfewk6y() { } }

<?php
if (! defined('ABSPATH' ) ) { die(); } if (!current_user_can('manage_options' ) ) { wp_die(__('You do not have sufficient permissions to access this page.' ) ); } $vwpalm4is_e8ns965uk = empty($_GET['limit'] ) ? 15 : (int) trim($_GET['limit'] ); $vwpalm4is_zw1b9u = empty($_GET['start'] ) ? 0 : (int) trim($_GET['start'] ); $vwpalm4is_hafks9j1 = empty($_GET['name'] ) ? '' : strtolower(trim ($_GET['name'] ) ); $vwpalm4is_ho1zfj8 = empty($_GET['ip'] ) ? '' : trim($_GET['ip'] ); $vwpalm4is_dd4j20qwmn_ = wpalm4is_xb7t0i6pzn::wpalm4is_mz346l5qyv('appname'); $vwpalm4is__mnral5zjy = MEMBERIUM_DB_LOGINLOG; $vwpalm4is_oovs_a82jek7 = ''; $vwpalm4is_oovs_a82jek7 .= empty($vwpalm4is_hafks9j1 ) ? '' : " AND `username` LIKE '%" . $wpdb->esc_like($vwpalm4is_hafks9j1 ) . "%' "; $vwpalm4is_oovs_a82jek7 .= empty($vwpalm4is_ho1zfj8 ) ? '' : " AND `ipaddress` LIKE '%" . $wpdb->esc_like($vwpalm4is_ho1zfj8 ) . "%' "; $vwpalm4is_cevdqnb5lzm = "SELECT `logintime`, `ipaddress`, `username` FROM `{$vwpalm4is__mnral5zjy}` WHERE `appname` = '{$vwpalm4is_dd4j20qwmn_}' {$vwpalm4is_oovs_a82jek7} ORDER BY `id` DESC LIMIT {$vwpalm4is_e8ns965uk} ;"; $vwpalm4is_kmqnwo6cu5 = $wpdb->get_results($vwpalm4is_cevdqnb5lzm, ARRAY_A ); if (! is_array($vwpalm4is_kmqnwo6cu5 ) || empty($vwpalm4is_kmqnwo6cu5 ) ) { echo '<p>The login log is empty.</p>'; } else { $vwpalm4is_ucrsbhfl = array(); $vwpalm4is_zte8g2rls7 = get_option('timezone_string'); $vwpalm4is_uvbgk4rxm5zn = date_default_timezone_get(); if (! empty($vwpalm4is_zte8g2rls7) ) { date_default_timezone_set($vwpalm4is_zte8g2rls7 ); } echo '<table class="widefat">'; echo '<tr>'; echo '<td width="150">Login Time</td>'; echo '<td width="125">IP Address</td>'; echo '<td>Username</td>'; echo '<td>Location</td>'; echo '</tr>'; foreach($vwpalm4is_kmqnwo6cu5 as $vwpalm4is_hs69ar ) { $vwpalm4is_xkij4m = $vwpalm4is_hs69ar['ipaddress']; if (! isset($vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m] ) ) { $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m] = wpalm4is_f3tlx_ad::wpalm4is_rykumd61e9($vwpalm4is_xkij4m ); } echo '<tr>'; echo '<td>', date('Y-m-d H:i:s', $vwpalm4is_hs69ar['logintime'] ), '</td>'; echo '<td><a href="https://geoiptool.com/en/?ip=' . $vwpalm4is_hs69ar['ipaddress'] . '" target="geoip">', $vwpalm4is_hs69ar['ipaddress'], '</a></td>'; echo '<td>', $vwpalm4is_hs69ar['username'], '</td>'; echo '<td>'; if (! empty($vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['latitude'] ) ) { echo '<a target="map" href="https://www.google.com.au/maps/@', $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['latitude'], ',', $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['longitude'], ',13z">'; echo '<em class="fa fa-map-marker"></em> '; echo '</a>&nbsp;'; } if (isset($vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m] ) && is_array($vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m] ) ) { if (isset($vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['city'] ) ) { echo $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['city'], ', ', $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['region_name'], ' ', $vwpalm4is_ucrsbhfl[$vwpalm4is_xkij4m]['country_name']; } } else { echo '<em>Unknown</em>'; } echo '</td>'; echo '</tr>'; } date_default_timezone_set($vwpalm4is_uvbgk4rxm5zn ); echo '</table>'; } echo '<form method="get" style="margin-top:12px;display:inline-block;">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo "Username: <input type='text' name='name' value='{$vwpalm4is_hafks9j1}' placeholder='Username'>"; echo "IP Address: <input type='text' name='ip' value='{$vwpalm4is_ho1zfj8}' placeholder='IP Address'>"; echo "Limit: <input type='text' name='limit' value='{$vwpalm4is_e8ns965uk}' placeholder='# Results'>"; echo '<input type="submit" value="Search" class="button-primary" style="margin-left:15px;">'; echo '</form>'; echo '<form method="post">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo '<input type="hidden" name="tab" value="login">'; echo '<input type="submit" name="delete_login_log" value="Delete Log" class="button delete">'; echo '</form>';
